# jps

### 命令描述

jps 命令类似与 linux 的 ps 命令，但是它只列出系统中所有的 Java 应用程序。 通过 jps 命令可以方便地查看 Java 进程的启动类、传入参数和 Java 虚拟机参数等信息。

用于列出目标系统上已检测到的Java虚拟机（JVM）

### 命令格式

```shel
jps [ options ] [ hostid ]

usage: jps [-help]
       jps [-q] [-mlvV] [<hostid>]
```

### 选项

- -q ：只显示进行id，这个选项不能和其他命令组合
- -m：显示出进行id、主类名、main函数的入参
- -l ：显示进行id、主类全路径
- -v：显示进行id、主类名、jvm参数
- -V：显示进行id、主类名

### 使用示例

#### 1. 本地进程查看：

``` shell
>>>> jps -l
5200
17096 org.jetbrains.jps.cmdline.Launcher
6840 org.jetbrains.jps.cmdline.Launcher
16588 org.jetbrains.idea.maven.server.RemoteMavenServer36
16924 com.firewolf.learn.test.Application
8972 sun.tools.jps.Jps
```

#### 2. 查看远程机器JVM进程：

1. 在远程机器编写jstatd.all.policy 策略文件

   ```powershell
   grant codebase "file:/home/lx/jdk1.8.0_251/lib/tools.jar" {
       permission java.security.AllPermission;
   };
   ```

   

2. 启动远程机器的jstatd服务器

   ```powershell
   jstatd -J-Djava.security.policy=jstatd.all.policy -J-Djava.rmi.server.hostname=10.122.101.34
   ```

3. 查看

   ```powershell
   jps 10.122.101.34
   ```



# jstat

### 命令描述

利用JVM内建的指令对Java应用程序的资源和性能进行实时的命令行的监控，包括了对Heap size和垃圾回收状况的监控。

### 命令格式

```powershell
jstat [ generalOption | outputOptions vmid [ interval["s"|"ms"] [ count ] ]

Usage: jstat -help|-options
       jstat -<option> [-t] [-h<lines>] <vmid> [<interval> [<count>]]
```

### 参数

- options： 参数选项

- -t： 可以在打印的列加上Timestamp列，用于显示系统运行的时间

- -h： 可以在周期性数据数据的时候，可以在指定输出多少行以后输出一次表头

- vmid： Virtual Machine ID（ 进程的 pid）

- interval： 执行每次的间隔时间，单位默认是毫秒，可以指定 "s"或者是"ms"

- count： 用于指定输出多少次记录，缺省则会一直打印

  

### 选项options

可以通过jstat -options来查看可以使用的选项，如下：

- -class ：显示ClassLoad的相关信息；
- -compiler： 显示JIT编译的相关信息；
- -gc ：显示和gc相关的堆信息；
- -gccapacity：显示各个代的容量以及使用情况；
- -gcmetacapacity：显示metaspace的大小
- -gcnew ：显示新生代信息；
- -gcnewcapacity：显示新生代大小和使用情况；
- -gcold：显示老年代和永久代的信息；
- -gcoldcapacity： 显示老年代的大小；
- -gcutil：显示垃圾收集信息；
- -gccause：显示垃圾回收的相关信息（通-gcutil）,同时显示最后一次或当前正在发生的垃圾回收的诱因；
- -printcompilation： 输出JIT编译的方法信息；



### 使用示例

#### 1. -class

显示加载class的数量，及所占空间等信息

```powershell
>>>> jstat -class 16924 1"s" 4
Loaded  Bytes  Unloaded  Bytes     Time
  6020 10832.0        1     0.9       5.39
  6020 10832.0        1     0.9       5.39
  6020 10832.0        1     0.9       5.39
  6020 10832.0        1     0.9       5.39
```

这里每隔1秒查看一次，一共查看4次

- Loaded : 已经装载的类的数量
- Bytes : 装载类所占用的字节数
- Unloaded：已经卸载类的数量
- Bytes：卸载类的字节数
- Time：装载和卸载类所花费的时间

#### 2. -compiler

显示VM实时编译(JIT)的数量等信息。

```powershell
>>>> jstat -compiler 16924
Compiled Failed Invalid   Time   FailedType FailedMethod
    2749      0       0     1.10          0
```

- Compiled：编译任务执行数量

- Failed：编译任务执行失败数量
- Invalid  ：编译任务执行失效数量
- Time  ：编译任务消耗时间
- FailedType：最后一个编译失败任务的类型
- FailedMethod：最后一个编译失败任务所在的类及方法

#### 3. -gc

显示gc相关的堆信息，查看gc的次数，及时间。

```powershell
>>>> jstat -gc 16924
 S0C    S1C    S0U    S1U      EC       EU        OC         OU       MC     MU    CCSC   CCSU   YGC     YGCT    FGC    FGCT     GCT
7168.0 10752.0 6897.1  0.0   114688.0 76338.0   83968.0     5233.5   26496.0 24839.3 3712.0 3371.4      4    0.054   1      0.048    0.102
```

- S0C：年轻代中第一个survivor（幸存区）的容量 （kB）
- S1C：年轻代中第二个survivor（幸存区）的容量 (kB)
- S0U ：年轻代中第一个survivor（幸存区）目前已使用空间 (kB)
- S1U ：年轻代中第二个survivor（幸存区）目前已使用空间 (kB)
- EC ：年轻代中Eden的容量 (kB)
- EU：年轻代中Eden目前已使用空间 (kB)
- OC：Old代的容量 (kB)
- OU：Old代目前已使用空间 (kB)
- MC：metaspace(元空间)的容量 (kB)
- MU：metaspace(元空间)目前已使用空间 (kB)
- CCSC：压缩的类空间容量（kB）
- CCSU：使用的压缩类空间（kB）
- YGC ：从应用程序启动到采样时年轻代中gc次数
- YGCT：从应用程序启动到采样时年轻代中gc所用时间(s)
- FGC：从应用程序启动到采样时old代(全gc)gc次数
- FGCT ：从应用程序启动到采样时old代(全gc)gc所用时间(s)
- GCT：从应用程序启动到采样时gc用的总时间(s)

#### 4. -gccapacity

可以显示，VM内存中三代（young,old,perm）对象的使用和占用大小

```powershell
 NGCMN    NGCMX     NGC     S0C   S1C       EC      OGCMN      OGCMX       OGC         OC       MCMN     MCMX      MC     CCSMN    CCSMX     CCSC    YGC    FGC
 86528.0 1382912.0 147968.0 7168.0 10752.0 114688.0   173568.0  2766336.0    83968.0    83968.0      0.0 1073152.0  26496.0      0.0 1048576.0   3712.0      4     1
```

- NGCMN：最小新一代容量（kB）。
- NGCMX：最大新一代容量（kB）。
- NGC：当前的新一代容量（kB）。
- S0C：当前幸存者空间0容量（kB）。
- S1C：当前生存空间1的容量（kB）。
- EC：当前伊甸园空间容量（kB）。
- OGCMN：old代的最小容量（kB）。
- OGCMX：odl代码的最大容量（kB）。
- OGC：old代当前新生成的容量 （kB）。
- OC：Old代的容量 （kB）。
- MCMN：最小元空间容量（kB）。
- MCMX：最大元空间容量（kB）。
- MC：元空间容量（kB）。
- CCSMN：压缩的类空间最小容量（kB）。
- CCSMX：压缩的类空间最大容量（kB）。
- CCSC：压缩的类空间容量（kB）。
- YGC：年轻代GC事件的数量。
- FGC：完整GC事件的数量。

#### 5. -gcmetacapacity

metaspace 中对象的信息及其占用量。

```powershell
>>>> jstat -gcmetacapacity 16924
   MCMN       MCMX        MC       CCSMN      CCSMX       CCSC     YGC   FGC    FGCT     GCT
       0.0  1073152.0    26496.0        0.0  1048576.0     3712.0     4     1    0.048    0.102
```

- MCMN:最小元数据容量
- MCMX：最大元数据容量
- MC：当前元数据空间大小
- CCSMN：最小压缩类空间大小
- CCSMX：最大压缩类空间大小
- CCSC：当前压缩类空间大小
- YGC  ：从应用程序启动到采样时年轻代中gc次数
- FGC   ：从应用程序启动到采样时old代(全gc)gc次数
- FGCT    ：从应用程序启动到采样时old代(全gc)gc所用时间(s)
- GCT：从应用程序启动到采样时gc用的总时间(s)

#### 6. -gcnew

年轻代对象的信息

```powershell
>>>> jstat -gcnew 16924
 S0C    S1C    S0U    S1U   TT MTT  DSS      EC       EU     YGC     YGCT
7168.0 10752.0 6897.1    0.0  7  15 10752.0 114688.0  78631.8      4    0.054
```

- S0C   ：年轻代中第一个survivor（幸存区）的容量 (kB)
- S1C   ：年轻代中第二个survivor（幸存区）的容量 (kB)
- S0U   ：年轻代中第一个survivor（幸存区）目前已使用空间 (kB)
- S1U  ：年轻代中第二个survivor（幸存区）目前已使用空间 (kB)
- TT：持有次数限制
- MTT：最大持有次数限制
- DSS：期望的幸存区大小
- EC：年轻代中Eden的容量 (kB)
- EU ：年轻代中Eden目前已使用空间 (kB)
- YGC ：从应用程序启动到采样时年轻代中gc次数
- YGCT：从应用程序启动到采样时年轻代中gc所用时间(s)

#### 7. -gcnewcapacity

年轻代对象的信息及其占用量

```powershell
>>>> jstat -gcnewcapacity 16924
  NGCMN      NGCMX       NGC      S0CMX     S0C     S1CMX     S1C       ECMX        EC      YGC   FGC
   86528.0  1382912.0   147968.0 460800.0   7168.0 460800.0  10752.0  1381888.0   114688.0     4     1
```

- NGCMN     ：年轻代(young)中初始化(最小)的大小(kB)
- NGCMX      ：年轻代(young)的最大容量 (kB)
- NGC     ：年轻代(young)中当前的容量 (kB)
- S0CMX    ：年轻代中第一个survivor（幸存区）的最大容量 (kB)
- S0C    ：年轻代中第一个survivor（幸存区）的容量 (kB)
- S1CMX ：年轻代中第二个survivor（幸存区）的最大容量 (kB)
- S1C：年轻代中第二个survivor（幸存区）的容量 (kB)
- ECMX：年轻代中Eden的最大容量 (kB)
- EC：年轻代中Eden的容量 (kB)
- YGC：从应用程序启动到采样时年轻代中gc次数
- FGC：从应用程序启动到采样时old代(全gc)gc次数

#### 8. -gcold

old代对象的信息

```powershell
>>>> jstat -gcold 16924
   MC       MU      CCSC     CCSU       OC          OU       YGC    FGC    FGCT     GCT
 26496.0  24839.3   3712.0   3371.4     83968.0      5233.5      4     1    0.048    0.102
```

- MC ：metaspace(元空间)的容量 (kB)
- MU：metaspace(元空间)目前已使用空间 (kB)
- CCSC:压缩类空间大小
- CCSU:压缩类空间使用大小
- OC：Old代的容量 (kB)
- OU：Old代目前已使用空间 (kB)
- YGC：从应用程序启动到采样时年轻代中gc次数
- FGC：从应用程序启动到采样时old代(全gc)gc次数
- FGCT：从应用程序启动到采样时old代(全gc)gc所用时间(s)
- GCT：从应用程序启动到采样时gc用的总时间(s)

#### 9. -gcoldcapacity

```powershell
>>>> jstat -gcoldcapacity 16924
   OGCMN       OGCMX        OGC         OC       YGC   FGC    FGCT     GCT
   173568.0   2766336.0     83968.0     83968.0     4     1    0.048    0.102
```

- OGCMN ：old代中初始化(最小)的大小 (kB)
- OGCMX ：old代的最大容量(kB)
- OGC ：old代当前新生成的容量 (kB)
- OC ：Old代的容量 (kB)
- YGC ：从应用程序启动到采样时年轻代中gc次数
- FGC ：从应用程序启动到采样时old代(全gc)gc次数
- FGCT ：从应用程序启动到采样时old代(全gc)gc所用时间(s)
- GCT：从应用程序启动到采样时gc用的总时间(s)

#### 10. -gcutil

统计gc信息

```powershell
>>>> jstat -gcutil 16924
  S0     S1     E      O      M     CCS    YGC     YGCT    FGC    FGCT     GCT
 96.22   0.00  68.56   6.23  93.75  90.83      4    0.054     1    0.048    0.102
```

- S0    ：年轻代中第一个survivor（幸存区）已使用的占当前容量百分比
- S1    ：年轻代中第二个survivor（幸存区）已使用的占当前容量百分比
- E     ：年轻代中Eden（伊甸园）已使用的占当前容量百分比
- O     ：old代已使用的占当前容量百分比
- P    ：perm代已使用的占当前容量百分比
- YGC  ：从应用程序启动到采样时年轻代中gc次数
- YGCT   ：从应用程序启动到采样时年轻代中gc所用时间(s)
- FGC   ：从应用程序启动到采样时old代(全gc)gc次数
- FGCT    ：从应用程序启动到采样时old代(全gc)gc所用时间(s)
- GCT：从应用程序启动到采样时gc用的总时间(s)

#### 11. -gccause

显示垃圾回收的相关信息（通-gcutil）,同时显示最后一次或当前正在发生的垃圾回收的诱因

```powershell
>>>> jstat -gccause 16924
  S0     S1     E      O      M     CCS    YGC     YGCT    FGC    FGCT     GCT    LGCC                 GCC
 96.22   0.00  68.56   6.23  93.75  90.83      4    0.054     1    0.048    0.102 Allocation Failure   No GC
```

- LGCC：最后一次GC原因
- GCC：当前GC原因（No GC 为当前没有执行GC

#### 12. -printcompilation

当前VM执行的信息

```powershell
>>>> jstat -printcompilation 16924
Compiled  Size  Type Method
    2759    195    1 java/util/concurrent/locks/AbstractQueuedSynchronizer doAcquireInterruptibly
```

- Compiled ：编译任务的数目
- Size ：方法生成的字节码的大小
- Type：编译类型
- Method：类名和方法名用来标识编译的方法。类名使用/做为一个命名空间分隔符。方法名是给定类中的方法。上述格式是由-XX:+PrintComplation选项进行设置的




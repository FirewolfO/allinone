时间线：

销售和客户周五已经聊好40W底库的共同意见，当时没反对，没有告知产研；二维码是否要测不定；



1. 29号产研知道pk

   上午：确定pk场景，确定负责人，出测试方案；

   - 抓拍机：（姜杭）

   - 面板机：（史泽鸿）

   - 盘古：（常豪鑫）

     https://wiki.megvii-inc.com/pages/viewpage.action?pageId=194776195

     

   下午1点（盘古）：

   盘古接视频流问题：

   - 底库大小限制10W；

   - 对于core做通行，通行速度，如果测通行速度，不用core，使用B3r
   - 要提供干扰库（只用我们的）； 
   - 确定去现场人员；
   - 干扰库优化方案（core提出）：md5标记+干扰库入库工具（刘立周日）；黄冰玉入全量库标记（周一）

   

   干扰库标记：

   md5标记；

   识别标记：干扰库入库工具+盘古入库标记；

   干扰库处理：topN发现干扰库的人员的时候过滤掉；

   

   下午4点（端）：

   - 初步确定面板机测试流程，确定方案，；
   - 干扰库特殊标记，topN方案；
   - 需要开活体；
   - 不确定是否要上动态底库；
   - 

   

   晚上：

   对标记方案进行优化（密码字段）；

   

2. 8.30

   开发（主要是刘立）

   

3. 8.31

   干扰库标记开发（冰玉、黄维、zuozhaoying），完成周六方案；

   刘爽：测试人员这块 初步定的是每家不超过5人，我和甲方争取到了周五测试8人的名额，周四调试12人或者不加限制

   粗糙的测试方案：太保人脸测试计划安排0901.docx

   pk方案和评分表：太保人脸识别综合评分表0901.xlsx

   - 没有抓拍机；
   - 没有静态比对；

   更改测试方案：测试方案8.31

   - 出现了静态比对；没注意到，没有讨论方案
   - 发现术语不是我们的，我们的方案没有被采纳；
   - 出现了结构化（双卡如果做脸人绑定+通行卡不够）
   - 确定底库提供方式，各提供10W组成40W；

   

   晚上：

   R提出动态底库方案，有了初步讨论；

   

   确定部署方案：泰豪版本在现场升级；

   

4. 9.1

   确定的测试方案：太保人脸识别性能测试方案-定稿版 (1)(1).docx

   下午开发静态比对功能（刘兴、shiyu）；

   动态底库方案确定并开发（骆明）；

   R提供干扰库

   验证40W底库页面导入（python脚本有问题，导入失败）；解决了很多底库导入的限制，导入速度很慢，约8小时---> 提出使用api直接导入；

   端提供出来动态底库版本，测试过程中有不少问题（sdk问题）；

   结构化部分希望再借一台服务器；

   通行记录修改后面开发（李yingjie+feihao）

   core提供解除底库入库速度限制的方案（yangkai）

   

   验证pk功能的正确性和阈值确定；因为入库问题没有完成；

   

   结构化方案：core做结构化去掉脸人绑定过功能，解决两张卡不够问题， 现场部署faced_video + 结构化videod

   

   

5. 9.2号

   优化底库导入：文豪开发导入工具、周曦优化导入速度；

   20人可以单独录入，文豪优化导入脚本（标记），静态检索、动态识别、面板机进行开发优化；

   端 优化弹窗策略，弹框和弹人脸几乎同时出来；

   端发布了多个版本供测试验证，sdk不同，是否开启动态底库；

   

   dev到现场：1点左右

   Yitu晚上六七点才到，没有vga线，插座、交换器、加密狗、

   原计划当天部署完盘古、录入干扰库，因为加密狗，啥都没做；

   

   现场联系借货加密狗：

   产研提出借 考拉加密狗+盘古授权；

   

   

6. 9.3号

   收到加密狗，授权

   部署core

   导入干扰库

   部署盘古，出问题了，编排问题，广宇解决；

   升级优化后的盘古服务；

   2点-6点：处理入库脚本

   2点收到30W+5W 底库开始导入

   导入图片的时候有图片格式没按照总集要求(jpg)，

   图片名有特殊字符导致的脚本导入失败；

   此处耗时较长，6点左右预处理完成；

   客户说要记录总入库时间：

   不确定是否要记录时间，跟客户提前沟通；

   脚本隐藏提示；

   

   端：

   隐藏密码，暴露了一些参数（facemin）和控制开关(topN等)，供现场临时更改；放弃了最后的3.9.x版本的sdk，恢复原始的3.8版本（验证发现不稳定，而且现场原因发现不需要，不需要动态底库和活体）

   

   6-9点：

   现场录入的时候，硬盘ssd，入库速度很快，系统出现很多问题：内存OOM和数据库连接数；导致录入操作了很多次；

   

   9-10：

   接入设备，core下发底库，

   

   11-3：

   面板机下发底库，验证

   测试core，调整现场阈值，发现动态底库topN 出现底库外误识问题，解决方案：添加双阈值策略（云使用，端添加了双阈值误识别解决的备份版本，后没有使用，采用阈值68）；

   

   3点的时候交付（李一土）说第二天可能只能用客户的电脑，担心第二天测试人员不能通过脚本导入，从而无法特殊标记，家里同学就改成第二天导入的人员直接标记成测试人员库；

   

   3点半完成

   更改结构化方案，

   

7. 9.4

   上午：

   更新aiot代码；

   导入25人底库

   测试面板机

   

   下午：

   测试视频流的时候，找不到对应时间的抓拍记录，原因是，服务器时间没有校对，比手机时间慢40秒所有；



产研问题：

1. 人员调动较晚；
2. 有些方案没有经过完整测试；



时间、测试方案、现场资源、现场表现、商务关系不明确。

录底库给海康机会，帮海康说好话、



面板机：测试方案不明确导致前后出了11个版本；




一、盘古相对太保存在的一些问题
1. 底库只支持10万；
2. 口罩识别不支持；
3. 人脸特征校验会导致部分底库导入失败，与总数相差可能较远；
4. 页面导出不支持2G以上文件；
5. 页面导入文件过多可能卡死，会导致录入底库失败；
6. 不支持批量静态图检索（无前端页面和后端功能）
7. 识别结果可能出现大量重复；
8. 识别准确率需要优化；
9. 客户可能要做结构化测试

二、盘古调优方案
1. 放开业务测导入底库数量的限制；
2. 升级core模型；
3. 通过参数配置，更改图片要求（盘古页面支持）
4. 页面放开文件大小限制
5. 通过脚本完成人员导入；
6. 临时开发功能来支持静态图检索，前端提供独立页面，后端通过干扰库标记来提高识别效果，后发现现场人员底库是
7. 通过开启一个后门界面来手动删除
8. 人员导入采用如下方案：
   - 导入自备10W干扰库
   - 导入30W混淆库，使用接口进行标记（脚本处理）
   - 导入测试人员底库的时候进行另一种标记
   - 识别的时候优先排除干扰库，使用测试人员库；
9. core两张卡的情况下，部署成 faced-video + 结构化 （现场没有抓拍机）；

三、现场问题
1. 9月2号设备到位，缺少加密狗；

2. 9月3号上午加密狗授权后安装完 core，导入了干扰库；

3. 盘古安装失败，编排有问题，家里同学更改编排后成功

4. 升级优化后的盘古服务；

5. 下午通过脚本导入混淆库（30W+5W），导入图片的时候有图片格式没按照总集要求，图片名有特殊字符导致的脚本导入失败；此处耗时较长，原因是脚本是其他同学用python编写的脚本，现场同学不熟，后通过shell修改文件名处理解决

6. 过程中了解到测试人员底库图是第二天单独给出，优化识别和静态搜索功能，给测试人员库打标记并优先撞匹配；

7. 晚上的时候交付（李一图）说第二天可能只能用客户的电脑，担心第二天测试人员不能通过脚本导入，从而无法特殊标记，家里同学就改成第二天导入的人员直接标记成测试人员库；

8. 9月4号上午，测试面板机一切正常；

9. 下午测试视频流的时候，找不到对应时间的抓拍记录，原因是，服务器时间没有校对，比手机时间慢40秒所有；

10. 导致客户不认我们识别结果，要求给出全景图，后熊珊珊通过日志找出了全景图，有惊无险；

11. 没有验证批量静态检索，走的单个静态检索（与当时定的检测方案有出入）

12. 现场没有验证结构化、二维码等，只是看了检测报告；

13. 现场部署的时候，部署了faced-video + faced-capture，没办法做结构化，

    产研给出方案：如果客户想验证功能，优先提供检测报告和盘古页面展示，最后实在不行的话，可以将 Core 重新编排为 faced-video + 结构化，但是一定要在人脸识别测试完成以后再改。

14. 在查看视频流识别效果的时候，有友商同学一直在旁边；

15. 打分的时候，友商一直有人在裁判后面说话；




四、做的好的&该做的
1. 整个过程中，产研的同学们都很积极的配合，不管是现场的还是家里的同学，都在加班加点，努力为各种出现的可能进行兜底准备；
	
2. 开发pk功能，直接并入主线，而不是每次临时切出分支做很多开发；
    如：

  - 底库数量的支持；
  - 全景图查看工具；

3. 目前操作步骤很多，现场处理的时候很麻烦。

   需要有一个统一的pk开关；

4. 去现场的同学要熟悉离线升级业务服务的方式，并携带基础镜像包，防止现场后有代码变更需要升级服务，如：sng-biz-base；

5. 以最坏的打算来进行准备，认为客户那边给不出外网，不允许通过自己的机器处理；

6. 售前同学尽量早的给产研同学同步项目情况，多留一些开发时间；

7. 对于可提供报告的，最好能够不要依赖报告，而是能够现场给出结果，防止出现友商现场演示自己却无法演示的情况；

8. 对于客户的把控，现场的同学都留点心眼儿，把友商挤开，不让他们有机会对我们的产品做出负面评论；

9. 如果友商有人跟客户聊天，需有人有意无意的在旁边一起聊， 防止别人说些不利的话；

10. 服务器、设备、网线等建议尽快到位，多准备，尽量多的争取现场调试时间，防止意外发生，及早做出应对；

11. 需要做的事情，建议统一一个wiki进行同步，在钉钉群里可能出现没看到关键信息的情况；

12. 考虑一些特殊的处理，狙击友商；
# 17 

- 算法插件化中间预估时间梳理：https://wiki.megvii-inc.com/pages/viewpage.action?pageId=258305855



# 18

- 参与MAC160接入方案讨论



# 19

- 产品委员会算法插件化详设评审
- 给马强讲解算法插件化详设

http://10.122.101.9/v5/videos

# 20

- 评审110门禁一卡通

nonmotorAnalyzer

# 21

- 修复https和http转换版本
- 盘古V1.0.2 rc1升级V1.0.2 rc2升级文档



问题：video添加nonmotorAnalyzer属性

```json
{
  "updateMask": {
    "paths": [
      "nonmotorAnalyzer"
    ]
  },
  "video": {
    "nonmotorAnalyzer": {
    "capture": {
      "analyzeOptions": {
        "extractAttributes": true,
        "extractFeature": true,
        "extractLicensePlate": true
      },
      "cropSetting": {
        "enabled": true
      },
      "filter": {
        "minHeightPixels": 0,
        "minWidthPixels": 0
      },
      "indexTtlSeconds": 604800,
      "kafkaTopic": "pangu_structure_topic",
      "panoramaSetting": {
        "enabled": true
      },
      "topic": "pangu_structure_topic",
      "ttlSeconds": 604800,
      "wholeTrack": false
    },
    "enable": true,
    "monitorSettings": {
      "kafkaTopic": "pangu_structure_topic",
      "limit": 1,
      "pubsubTopic": "pangu_structure_topic"
    }
  }
  }
}
```



```
{
	"nonmotorAnalyzer": {
    "capture": {
      "analyzeOptions": {
        "extractAttributes": true,
        "extractFeature": true,
        "extractLicensePlate": true
      },
      "cropSetting": {
        "enabled": true
      },
      "filter": {
        "minHeightPixels": 0,
        "minWidthPixels": 0
      },
      "indexTtlSeconds": 604800,
      "kafkaTopic": "pangu_structure_topic",
      "panoramaSetting": {
        "enabled": true
      },
      "topic": "pangu_structure_topic",
      "ttlSeconds": 604800,
      "wholeTrack": false
    },
    "enable": true,
    "monitorSettings": {
      "kafkaTopic": "pangu_structure_topic",
      "limit": 1,
      "pubsubTopic": "pangu_structure_topic"
    }
  }
}
```

```
{"description":"","url":"iot://10.122.101.9:8545/?deviceID=110000200100000002\u0026mode=video","name":"AIOT_08ceebc455e74e9f96037470a3e3f48c","id":"372fb4c0-9c13-40a9-8df7-35667b06e6c8","recognitionArea":{"viewports":[],"occlusionAreas":[],"relativeViewports":[],"relativeOcclusionAreas":[]},"faceAnalyzer":{"capture":{"analysisSettings":{"age":true,"gender":true,"minority":true,"eyeStatus":true,"mouthStatus":true,"liveness":true,"expression":false},"cropMode":{"cropFace":{"enabled":true,"imageSavePath":"ag-capture-mid","imageTtlSeconds":"15552000"},"cropBody":{"enabled":true,"imageSavePath":"ag-capture-mid","imageTtlSeconds":"15552000"},"cropFull":{"enabled":true,"imageSavePath":"ag-full-mid","imageTtlSeconds":"7776000"}},"output":{"topic":"pangu_structure_topic","outputFeature":true,"faceGroupId":"9c073162-883b-4c6f-824c-61adfb80f400","netgateDeviceId":"","kafkaTopic":"pangu_structure_topic"},"wholeTrack":false,"filter":{"minWidthPixels":0,"minHeightPixels":0},"ttlSeconds":"604800","indexTtlSeconds":"604800"},"monitors":[],"enable":true,"alertPolicy":{"messageTypePolicy":"SINGLE","messageFilterPolicy":"FILTER"},"monitorSettings":{"trackStatTopic":""},"customSettings":""},"pedestrianAnalyzer":{"capture":{"analyzeOptions":{"extractFeature":true,"extractAttributes":true},"topic":"pangu_structure_topic","wholeTrack":false,"filter":{"minWidthPixels":0,"minHeightPixels":0},"cropSetting":{"enabled":true,"imageSavePath":"ag-capture-mid","imageTtlSeconds":"15552000"},"kafkaTopic":"pangu_structure_topic","ttlSeconds":"604800","indexTtlSeconds":"604800","pedestrianGroupId":"PDGe4669d4c-75b2-4c05-bfb2-8fc2c3527643","panoramaSetting":{"enabled":true,"imageSavePath":"ag-full-mid","imageTtlSeconds":"7776000"}},"monitors":[],"enable":true,"monitorSettings":{"limit":1,"pubsubTopic":"pangu_structure_topic","kafkaTopic":"pangu_structure_topic"}},"vehicleAnalyzer":{"capture":{"analyzeOptions":{"extractFeature":true,"extractLicensePlate":true,"extractAttributes":true,"experimentalOutputLicensePlate":false},"topic":"pangu_structure_topic","wholeTrack":false,"filter":{"minWidthPixels":0,"minHeightPixels":0},"cropSetting":{"enabled":true,"imageSavePath":"ag-capture-mid","imageTtlSeconds":"15552000"},"kafkaTopic":"pangu_structure_topic","ttlSeconds":"604800","indexTtlSeconds":"604800","vehicleGroupId":"VHG1d1ad261-4c33-41ff-b125-a9642fa47a0e","panoramaSetting":{"enabled":true,"imageSavePath":"ag-full-mid","imageTtlSeconds":"7776000"}},"monitors":[],"enable":true,"monitorSettings":{"limit":1,"pubsubTopic":"pangu_structure_topic","kafkaTopic":"pangu_structure_topic"}},"errors":[],"status":"VIDEO_PAUSED","stateChangeTopic":"","videoParameters":{"QPS":1,"resolution":"PIXELS_200W","captureMode":"CROP","videoModel":"NORMAL"},"restartPolicy":"ALWAYS","pipelineSwitches":{"lowLatency":false,"frameSkipPolicy":"SKIP_NONE","linkMode":"PVF_THEN_FACE_ALL","messageSkipPolicy":"SKIP","withTrackStat":false,"analyzeAllTargets":false,"pipelineName":""},"netgateDeviceId":"","demodAnalyzers":[],"messageTags":{},"analyzeSettings":{"pvfAnalyzeIntervalMillis":"0","interruptableIntervalMillis":"200"}}
```





```
人员升级失败：
2021-May-22 11:10:09.953 INFO  [ConsumeMessageThread_5] [TID:ef0acdf8-857b-453c-890a-71eb2e6b35dc] c.m.e.p.m.p.p.service.impl.MiddleMethodCallService - personQueryByFace req:PersonFaceQueryReq(uri=_ZzEwMF82bQ==_cbd672896e6345bbaa78e7feba3e4ebf, uriType=1, threshold=60.0, limit=20, imageData=null, featureData=null, featureVersion=null, groupId=null)
2021-May-22 11:10:10.203 INFO  [ForkJoinPool.commonPool-worker-22] [TID:95f647d525004635a46793d4e636c984] c.m.e.p.m.p.p.handle.PersonClusterUpgradeHandler - deviceId is:282, get device info success !, videoId:b2e38872-ca28-49c5-a19e-9de39f456f45,faceGroupId:cb058a4b-ffda-45da-829d-5fac996b3590
2021-May-22 11:10:10.248 INFO  [ForkJoinPool.commonPool-worker-22] [TID:95f647d525004635a46793d4e636c984] c.m.e.p.starter.compoment.FeignClientErrorDecoder - 返回的状态为:{}
2021-May-22 11:10:10.249 INFO  [ForkJoinPool.commonPool-worker-22] [TID:95f647d525004635a46793d4e636c984] c.m.e.p.starter.compoment.FeignClientErrorDecoder - original error content : {"requestId":"6da650b3-dcc5-439d-a432-da57a88416bc","code":"PreconditionFailed","message":"fail to pause job af47ec8a-7d68-4eb7-861c-602a6ea1feed, because it's state is PAUSED"}

2021-May-22 11:10:10.251 ERROR [ForkJoinPool.commonPool-worker-22] [TID:95f647d525004635a46793d4e636c984] c.m.e.p.m.p.p.handle.PersonClusterUpgradeHandler - device upgrade error, e:{}
com.megvii.bbu.common.util.bone.MegviiException: {"requestId":"6da650b3-dcc5-439d-a432-da57a88416bc","code":"PreconditionFailed","message":"fail to pause job af47ec8a-7d68-4eb7-861c-602a6ea1feed, because it's state is PAUSED"}

        at com.megvii.ebg.pangu.starter.compoment.FeignClientErrorDecoder.decode(FeignClientErrorDecoder.java:48) ~[pangu-starter-1.0.2-main-test-SNAPSHOT.jar!/:1.0.2-main-test-SNAPSHOT]
        at feign.SynchronousMethodHandler.executeAndDecode(SynchronousMethodHandler.java:138) ~[feign-core-9.5.1.jar!/:na]
        at feign.SynchronousMethodHandler.invoke(SynchronousMethodHandler.java:76) ~[feign-core-9.5.1.jar!/:na]
        at feign.ReflectiveFeign$FeignInvocationHandler.invoke(ReflectiveFeign.java:103) ~[feign-core-9.5.1.jar!/:na]
        at com.sun.proxy.$Proxy172.pauseVideo(Unknown Source) ~[na:na]
        at com.megvii.ebg.pangu.ms.person.provider.service.impl.CoreService.pauseVideo(CoreService.java:344) ~[classes!/:1.0.2-main-test-SNAPSHOT]
        at com.megvii.ebg.pangu.ms.person.provider.handle.PersonClusterUpgradeHandler.deviceUpgrade(PersonClusterUpgradeHandler.java:179) [classes!/:1.0.2-main-test-SNAPSHOT]
        at com.megvii.ebg.pangu.ms.person.provider.handle.PersonClusterUpgradeHandler.deviceVideoRelationUpgrade(PersonClusterUpgradeHandler.java:150) [classes!/:1.0.2-main-test-SNAPSHOT]
        at com.megvii.ebg.pangu.ms.person.provider.handle.PersonClusterUpgradeHandler.personClusterUpgrade(PersonClusterUpgradeHandler.java:84) [classes!/:1.0.2-main-test-SNAPSHOT]
        at com.megvii.ebg.pangu.ms.person.provider.handle.PersonClusterUpgradeHandler.lambda$clusterUpgrade$0(PersonClusterUpgradeHandler.java:101) [classes!/:1.0.2-main-test-SNAPSHOT]
        at java.util.concurrent.CompletableFuture$AsyncRun.run(CompletableFuture.java:1626) ~[na:1.8.0_141]
        at java.util.concurrent.CompletableFuture$AsyncRun.exec(CompletableFuture.java:1618) ~[na:1.8.0_141]
        at java.util.concurrent.ForkJoinTask.doExec(ForkJoinTask.java:289) ~[na:1.8.0_141]
        at java.util.concurrent.ForkJoinPool$WorkQueue.runTask(ForkJoinPool.java:1056) ~[na:1.8.0_141]
        at java.util.concurrent.ForkJoinPool.runWorker(ForkJoinPool.java:1692) ~[na:1.8.0_141]
        at java.util.concurrent.ForkJoinWorkerThread.run(ForkJoinWorkerThread.java:157) ~[na:1.8.0_141]
2021-May-22 11:10:10.406 INFO  [ConsumeMessageThread_5] [TID:ef0acdf8-857b-453c-890a-71eb2e6b35dc] c.m.e.p.m.p.p.service.impl.MiddleMethodCallService - personQueryByFace resp:PersonFaceQueryResp(faceRespList=[]
```
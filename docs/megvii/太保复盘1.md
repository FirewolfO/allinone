

## 整体统计

1. 投入人力：开发+测试 （25人）
2. 面板机：前后出了11个版本
3. 出了十多个方案并落实；

## 重点方案

1. 通行速度使用B3R；
2. 干扰库标记提高识别准确度，影响范围较大（云+端+数据导入）；
3. 结构化 需加服务器
4. 结构化 部署faced-video + 结构化；
5. 通过后门方式修改通行记录；
6. 结构化临时更改编排（没有落实）
7. 静态搜索通过标记的干扰库和测试人员库优化；
8. 口罩识别外挂M模型
9. 动态底库
10. 现场临时优化导入标记

## 时间线

8月29号

-----

上午：

1. 产研知悉pk信息；
2. 确定pk场景，确定负责人，会议上让产研给出测试方案；



下午1点（盘古会议）：

- 盘古接视频流问题确认；

- 底库大小限制10W，此时从售前判断认为商务关系比较过硬，没有关注底库问题；

- 通行速度方案：如果测通行速度，不用core，使用B3R，要准备B3R；

- 要提供干扰库（此时认为只用我们的）； 

- 确定去现场人员；

- core提供干扰库优化方案

  标记：

  - md5标记
  - 特殊底库标志干扰库（刘立周日开发） + 盘古入库标记（黄冰玉）；

  处理：

  - 识别结果topN发现干扰库人员的时候过滤掉；

  

下午4点（端设备会议）：

- 初步确定面板机测试流程，确定方案；
  - 干扰库特殊标记，topN方案；
  - 需要开活体；
  - 不确定是否要上动态底库；

晚上：

端对标记方案进行优化（通过已知字段处理）；



8.30

----

开发落实29号方案（主要是刘立）



8.31

----

上午：

- 研发侧主要是完成8月29号的方案：干扰库标记开发（黄冰玉、黄维、左钊颖）

- 确定core版本，确定口罩识别方案，core外挂M模型用于现场测试

16点多：

重新安排去现场人员（刘爽同步和甲方争取到了周五现场8人测试名额）

有了粗糙的测试方案（太保人脸测试计划安排0901.docx ） 以及  pk方案和评分表（太保人脸识别综合评分表0901.xlsx），重点信息如下：

- 没有抓拍机；
- 没有静态比对；

18点半：

更改测试方案：测试方案8.31.png，有如下变动：

- 出现了静态比对；此时没注意到，没有讨论方案
- 发现术语不是我们的，我们的方案没有被采纳；
- 出现了结构化，出现资源不够的问题：现场双卡如果做脸人绑定+通行卡，再加上结构化，卡不够
- 确定底库提供方式，各提供10W组成40W（销售和客户周五已经聊好40W底库的共同意见，当时没反对，没有告知产研，意识到高风险）；

晚上：

- R提出动态底库方案，有了初步讨论；

- 确定部署方案：使用盘古泰豪版本在现场升级；
- 姜杭提出通过后门页面来修改通行记录的方案；



9.1

----

- 拿到确定的测试方案：太保人脸识别性能测试方案-定稿版 (1)(1).docx

- 动态底库方案确定并开发（骆明）；
- R提供出干扰库
- 验证40W底库页面导入（python脚本有问题，导入失败）；过程中解决了很多底库导入的限制，且导入速度很慢，估算约8小时，提出更改脚本使用api直接导入；
- 端提供出来动态底库版本，测试过程中有不少问题（sdk问题）；
- 给出结构化方案：希望再借一台服务器；
- 通行记录修改后门开发（李颖杰、赵斐昊）
- 下午开发静态比对功能（刘兴、史雨）；
- core提供解除底库入库速度限制的方案（杨凯）
- 结构化部分借服务器无望，更新方案：core做结构化去掉脸人绑定过功能，解决两张卡不够问题， 现场部署faced_video + 结构化
- 确定去现场人员（去现场人数一直不定）

原计划当天部署好现场环境，验证pk功能的正确性和阈值确定，结果因为入库问题没有完成（底库量相关的一些限制）；



9.2号

---

- 更改优化底库导入：陈文豪开发导入脚本、周汐优化导入速度；

- 知悉20人可以单独录入，再次优化导入脚本（标记），静态检索、动态识别、面板机识别进行开发优化；

- 端 优化弹窗策略，弹框和j结果几乎同时出来；
- 端做了很多更新，如替换sdk，添加动态底库开关等，发布了多个版本供测试验证。
- dev 1点多到现场附近，现场相机没到，没有vga线，插座、交换器、加密狗等，dev 6点到现场，交付晚上七点多到现场；

原计划当天部署完盘古、录入干扰库，因为没有加密狗，什么都没做；现场联系借货加密狗：产研提出借 考拉加密狗+盘古授权；



9.3号

----

上午：准备盘古环境

- 收到加密狗，授权
- 部署core
- 升级口罩模型
- 导入干扰库
- 部署盘古，出问题了，编排问题，赫广宇远程解决；
- 升级优化后的盘古服务；

2点-6点：处理入库脚本

- 2点收到35W 底库开始导入

- 导入图片的时候出现两个底库导入脚本不支持的问题

  - 图片格式没按照总集要求(jpg)‘
  - 图片名有特殊字符；

  此处耗时较长，6点左右预处理完成；此期间，客户说要记录总入库时间，开始导入的时候，跟客户进行了沟通，说明情况。

18-21点：正式导入混淆库

- 现场录入的时候，硬盘ssd，入库速度很快，系统出现很多问题：内存OOM和数据库连接数；导致录入操作了很多次；
- 标记接口出问题：意识到既然给了全部底库，有更好的方法，直接标记；

21-22点：

- 接入设备，core下发底库，

23-凌晨3点：

- 面板机下发底库，验证

- 测试core，调整现场阈值，发现动态底库topN 出现底库外误识问题，解决方案

  - 云端采用添加双阈值策略；

  - 端添加了双阈值误识别解决的备份版本，后没有使用，调整阈值为68解决；

    

凌晨3点：预备人员导入方案

- 交付（李一土）说第二天可能只能用客户的电脑，担心第二天测试人员不能通过脚本导入，从而无法特殊标记，周汐修改人员导入方案为第二天导入的人员直接标记成测试人员库；



凌晨3点半：完成

其他：

- 当天端的处理：隐藏密码，暴露了一些参数（facemin）和控制开关(topN等)，供现场临时更改；放弃了最后的3.9.x版本的sdk，恢复原始的3.8版本（验证发现不稳定，而且现场原因发现不需要，不需要动态底库和活体）

- 结构化方案更改
  - 问题：此期间发现现场部署为faced-video+faced-caputer，无法做结构化，
  - 方案：如果客户想验证功能，优先提供检测报告和盘古页面展示，最后实在不行的话，可以将 Core 重新编排为 faced-video + 结构化，但是一定要在人脸识别测试完成以后再改



9.4

----

上午：

- 更新aiot代码；

- 导入25人底库

- 测试面板机

下午：

- 测试视频流：找不到对应时间的抓拍记录，原因是，服务器时间没有校对，比手机时间慢40秒所有；



## 总结

#### 做的好的

1. 整个过程中，产研的同学们都很积极的配合，不管是现场的还是家里的同学，都在加班加点，努力为各种出现的可能进行兜底准备；
2. 现场非产研的同学都积极配合产研协调资源；

####  不好的

- 时间、测试方案、商务关系不明确，变动次数较多，导致方案一直变动，做了不少无用功；
- 现场资源不够齐全，如：加密狗、网线等，导致现场调试时间缩短；
- 产研人员调动较晚；
- 有些方案没有经过完整测试，直接现场硬上，风险很高；

####  以后该做的

1. 开发pk功能，直接并入主线，而不是每次临时切出分支做很多开发；
     如：

     - 底库数量的支持；
     - 全景图查看工具；

3. 目前操作步骤很多，现场处理的时候很麻烦。

   需要有一个统一的pk开关；

4. 去现场的同学要熟悉离线升级业务服务的方式，并携带基础镜像包，防止现场后有代码变更需要升级服务，如：sng-biz-base；

5. 以最坏的打算来进行准备，认为客户那边给不出外网，不允许通过自己的机器处理；

6. 售前同学尽量早的给产研同学同步项目情况，多留一些开发时间；

7. 对于可提供报告的，最好能够不要依赖报告，而是能够现场给出结果，防止出现友商现场演示自己却无法演示的情况；

8. 对于客户的把控，现场的同学都留点心眼儿，把友商挤开，不让他们有机会对我们的产品做出负面评论；

9. 如果友商有人跟客户聊天，需有人有意无意的在旁边一起聊， 防止别人说些不利的话；

10. 服务器、设备、网线等建议尽快到位，多准备，尽量多的争取现场调试时间，防止意外发生，及早做出应对；

11. 需要做的事情，建议统一一个wiki进行同步，在钉钉群里可能出现没看到关键信息的情况；

12. 考虑一些特殊的处理，狙击友商；
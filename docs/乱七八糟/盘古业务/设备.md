### 面板机状态流程



```
获取设备信息接口调用,device_token:bb69cc6c6f194630853a0ff51ae7487b


```

![image-20211222154029240](https://gitee.com/firewolf/allinone/raw/master/images/image-20211222154029240.png)

```
grep "更新设备信息" | grep "bb69cc6c6f194630853a0ff51ae7487b"
```

![image-20211222154147179](https://gitee.com/firewolf/allinone/raw/master/images/image-20211222154147179.png)

```

2021-Dec-20 11:37:18.577 INFO  [http-nio-18083-exec-7] [TID:93c852c7-abb6-4319-8a78-c2b06fe2b1da] c.m.e.p.facade.device.controller.DeviceController - "bb69cc6c6f194630853a0ff51ae7487b"更新设备信息{"status":4}
```

```
[http-nio-18083-exec-7] [TID:93c852c7-abb6-4319-8a78-c2b06fe2b1da] c.m.e.p.facade.device.controller.DeviceController - "bb69cc6c6f194630853a0ff51ae7487b"更新设备信息{"status":4}
2021-Dec-20 11:37:18.579 DEBUG [http-nio-18083-exec-7] [TID:93c852c7-abb6-4319-8a78-c2b06fe2b1da] o.s.web.client.HttpMessageConverterExtractor - Reading [class com.megvii.middle_end.device.api.dto.response.BaseDeviceResp] as "application/json;charset=UTF-8" using [com.alibaba.fastjson.support.spring.FastJsonHttpMessageConverter@2ad4a868]
```



![image-20211222150956300](https://gitee.com/firewolf/allinone/raw/master/images/image-20211222150956300.png)



```
2021-Dec-20 11:32:15.923 INFO  [device-action-consumer-pool-1] [TID:] c.m.m.m.d.p.service.cmd.DeviceActionConsumer - doDeviceAction redisKeyList:[]
2021-Dec-20 11:32:16.482 INFO  [http-nio-18090-exec-6] [TID:fe73f593-19c9-4ce4-9511-b6e1d2974965] c.m.b.m.device.service.impl.BaseDeviceService - base device queryByDeviceUUId ,deviceId:null,uuid:bb69cc6c6f194630853a0ff51ae7487b
2021-Dec-20 11:32:16.485 WARN  [http-nio-18090-exec-6] [TID:fe73f593-19c9-4ce4-9511-b6e1d2974965] c.m.e.p.s.c.BaseControllerExceptionHandlerAdvice - 执行出现异常
com.megvii.middle_end.common.domain.exception.BusinessException: deviceToken不存在
        at com.megvii.bbu.middle_end.device.service.impl.BaseDeviceService.queryByDeviceIdOrUUid(BaseDeviceService.java:404) ~[classes!/:1.0.6.1-SNAPSHOT]
        at com.megvii.bbu.middle_end.device.service.impl.BaseDeviceService$$FastClassBySpringCGLIB$$48d31207.invoke(<generated>) ~[classes!/:1.0.6.1-SNAPSHOT]
        at org.springframework.cglib.proxy.MethodProxy.invoke(MethodProxy.java:204) ~[spring-core-5.0.7.RELEASE.jar!/:5.0.7.RELEASE]
        at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:684) ~[spring-aop-5.0.7.RELEASE.jar!/:5.0.7.RELEASE]
        at com.megvii.bbu.middle_end.device.service.impl.BaseDeviceService$$EnhancerBySpringCGLIB$$a74662c1.queryByDeviceIdOrUUid(<generated>) ~[classes!/:1.0.6.1-SNAPSHOT]
        at com.megvii.middle_end.micro.device.provider.web.DeviceController.queryByDeviceIdOrUUid(DeviceController.java:509) ~[classes!/:1.0.6.1-SNAPSHOT]
        at sun.reflect.GeneratedMethodAccessor505.invoke(Unknown Source) ~[na:na]
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[na:1.8.0_141]
        at java.lang.reflect.Method.invoke(Method.java:498) ~[na:1.8.0_141]
        at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:209) ~[spring-web-5.0.7.RELEASE.jar!/:5.0.7.RELEASE]
        at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:136) ~[spring-web-5.0.7.RELEASE.jar!/:5.0.7.RELEASE]
        at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:102) ~[spring-webmvc-5.0.7.RELEASE.jar!/:5.0.7.RELEASE]
        at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:877) ~[spring-webmvc-5.0.7.RELEASE.jar!/:5.0.7.RELEASE]
        at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:783) ~[spring-webmvc-5.0.7.RELEASE.jar!/:5.0.7.RELEASE]
        at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87) ~[spring-webmvc-5.0.7.RELEASE.jar!/:5.0.7.RELEASE]
        at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:991) ~[spring-webmvc-5.0.7.RELEASE.jar!/:5.0.7.RELEASE]
        at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:925) ~[spring-webmvc-5.0.7.RELEASE.jar!/:5.0.7.RELEASE]
        at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:974) ~[spring-webmvc-5.0.7.RELEASE.jar!/:5.0.7.RELEASE]
        at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:866) ~[spring-webmvc-5.0.7.RELEASE.jar!/:5.0.7.RELEASE]
        at javax.servlet.http.HttpServlet.service(HttpServlet.java:635) [tomcat-embed-core-8.5.31.jar!/:8.5.31]
        at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:851) ~[spring-webmvc-5.0.7.RELEASE.jar!/:5.0.7.RELEASE]
        at javax.servlet.http.HttpServlet.service(HttpServlet.java:742) [tomcat-embed-core-8.5.31.jar!/:8.5.31]
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:231) [tomcat-embed-core-8.5.31.jar!/:8.5.31]
```



```
root@M014302002102000015:/mnt/data/pangu/safeguard/log/middle-end-device# zcat  middle*.gz | grep  'base device delete' | grep '283'
2021-Dec-19 20:43:34.174 INFO  [http-nio-18090-exec-2] [TID:174a3d664b1f4d43a8662cec3ee9d0b3] c.m.m.m.d.p.s.impl.BaseDeviceOperationServiceImpl - base device delete ,req[deviceId:283,deviceUuid:null]
2021-Dec-19 20:43:34.175 INFO  [http-nio-18090-exec-2] [TID:174a3d664b1f4d43a8662cec3ee9d0b3] c.m.m.m.d.p.s.impl.BaseDeviceOperationServiceImpl - base device delete_offLineDelete,req[deviceId:283,deviceUuid:null]
```





```
devops@M014302002102000015:/mnt/data/pangu/safeguard/log/device$ zcat  pangu-facade-device.log.2021-12-20.*.gz | grep 'device pad register,deviceToken' | grep 'M014200372106004769'
2021-Dec-20 11:32:16.504 INFO  [http-nio-18083-exec-8] [TID:fe73f593-19c9-4ce4-9511-b6e1d2974965] c.m.ebg.pangu.facade.device.service.DeviceService - device pad register,deviceToken:bb69cc6c6f194630853a0ff51ae7487b.req:PadRegisterReqDto(deviceToken=bb69cc6c6f194630853a0ff51ae7487b, snCode=M014200372106004769, romVersion=V1.2.1, appVersion=V1.2.1, appChannel=MegEye-W4K-E7, factorySetting=true, deviceModel=MegEye-W4K-E7, deviceMode=null, ipAddress=null, port=null, functionType=1)
2021-Dec-20 11:32:16.511 INFO  [http-nio-18083-exec-8] [TID:fe73f593-19c9-4ce4-9511-b6e1d2974965] c.m.ebg.pangu.facade.device.service.DeviceService - device pad register,deviceToken:bb69cc6c6f194630853a0ff51ae7487b,build req:DeviceReq(id=null, uuid=bb69cc6c6f194630853a0ff51ae7487b, name=null, snCode=M014200372106004769, ipAddress=null, location=null, deviceType=2, deviceModel=2, functionType=1, romVersion=109, appVersion=null, companyId=null, companyUuid=null, mac=null, status=null, upgradeStatus=null, gmtCreate=null, firstActiveTime=null, gmtModified=null, isPublic=null, deviceDesc=null, offlineTime=null, targetAppVersion=null, targetRomVersion=null, newestAppVersion=null, newestRomVersion=null, forceUpdate=null, upgradeable=null, otaStatus=null, appChannel=MegEye-W4K-E7, cpuUsage=null, memoryUsage=null, diskUsage=null, userName=null, userPassword=null, switchIp=null, rtspUrl=null, mapId=null, discoveryMethod=null, deviceMode=null, mapLat=null, mapLon=null, port=null, center=null, protocol=null, activeMode=null, isSupportActiveSdk=null, joinProtocol=null)
2021-Dec-20 11:33:42.444 INFO  [http-nio-18083-exec-7] [TID:9cda90b3-5d76-4b8e-a6e3-9b43500c1a93] c.m.ebg.pangu.facade.device.service.DeviceService - device pad register,deviceToken:bb69cc6c6f194630853a0ff51ae7487b.req:PadRegisterReqDto(deviceToken=bb69cc6c6f194630853a0ff51ae7487b, snCode=M014200372106004769, romVersion=V1.2.1, appVersion=V1.2.1, appChannel=MegEye-W4K-E7, factorySetting=true, deviceModel=MegEye-W4K-E7, deviceMode=null, ipAddress=null, port=null, functionType=1)
```





```
root@M014302002102000015:/mnt/data/pangu/safeguard/log/device# zcat pangu-facade-device.log.2021-12-22.3.gz  | grep '更新设备信息'
2021-Dec-22 14:06:29.197 INFO  [http-nio-18083-exec-30] [TID:cb9c7abc-edf2-4f97-b584-64bbdfea80ca] c.m.e.p.facade.device.controller.DeviceController - "32cbfadefb984eb7a686c248ccf70605"更新设备信息{"status":4}
root@M014302002102000015:/mnt/data/pangu/safeguard/log/device# 

2021-Dec-22 14:05:53.456 INFO  [http-nio-18083-exec-21] [TID:8de350a7-6e65-44c0-a386-89d06721a961] c.m.e.p.facade.device.controller.DeviceController - 获取设备信息接口调用,device_token:32cbfadefb984eb7a686c248ccf70605
2021-Dec-22 14:05:58.559 INFO  [http-nio-18083-exec-21] [TID:8c32c783-8a49-4691-b6f8-b8bac8736efa] c.m.e.p.facade.device.controller.DeviceController - 获取设备信息接口调用,device_token:32cbfadefb984eb7a686c248ccf70605
2021-Dec-22 14:06:03.659 INFO  [http-nio-18083-exec-1] [TID:b87dfd94-8946-43a4-b6ff-a1d1a8af43ee] c.m.e.p.facade.device.controller.DeviceController - 获取设备信息接口调用,device_token:32cbfadefb984eb7a686c248ccf70605
2021-Dec-22 14:06:08.763 INFO  [http-nio-18083-exec-21] [TID:83560fbd-e5fe-41f8-a70f-269d129c2b09] c.m.e.p.facade.device.controller.DeviceController - 获取设备信息接口调用,device_token:32cbfadefb984eb7a686c248ccf70605
2021-Dec-22 14:06:13.864 INFO  [http-nio-18083-exec-12] [TID:78e522b1-614e-479d-97f1-5cbfa6884250] c.m.e.p.facade.device.controller.DeviceController - 获取设备信息接口调用,device_token:32cbfadefb984eb7a686c248ccf70605
2021-Dec-22 14:06:29.189 INFO  [http-nio-18083-exec-5] [TID:cb9c7abc-edf2-4f97-b584-64bbdfea80ca] c.m.e.p.facade.device.controller.DeviceController - 获取设备信息接口调用,device_token:32cbfadefb984eb7a686c248ccf70605
root@M014302002102000015:/mnt/data/pangu/safeguard/log/device# 
```



grep "获取设备信息接口调用" | grep "32cbfadefb984eb7a686c248ccf70605"




1. Bug修复
   - 物品和警戒部署在两张卡上只有一张卡用到问题修复。
2. 人数统计技术方案调整
3. 调整部署文档
   - core新镜像去掉了 --decoder.interval参数，导致警戒算法仓启动失败
4. 



警戒

```
bash -c "/opt/limbo/entrypoint.sh python3 -u run_limbo_app.py --port 8424 --gpu_list 0 --demod_addr M014800012010000012:8423; echo 'Program exits, sleep 5 seconds before restart' && sleep 5"
```



物品

```
bash -c "python3 goods/goods_app.py --demod M014800012010000012:8427 --port 8428; echo 'Program exits, sleep 5 seconds before restart' && sleep 5"
```



nvidia-smi：

```
+-----------------------------------------------------------------------------+
| Processes:                                                       GPU Memory |
|  GPU       PID   Type   Process name                             Usage      |
|=============================================================================|
|    0    227403      C   demod/bin/demod-goflow                       129MiB |
|    0    339002      C   python3                                     1399MiB |
|    0    339016      C   python3                                     1399MiB |
|    0    345644      C   demod/bin/demod-goflow                       199MiB |
|    1    672437      C   python3                                     2147MiB |
|    1    672445      C   python3                                      811MiB |
|    1    672474      C   python3                                      811MiB |
|    1    672884      C   demod/bin/demod-goflow                        99MiB |
+-----------------------------------------------------------------------------+
```



```shell
docker pull ampregistry:5000/pangu-nginx:release-1.0.5-rc1-patch2
docker save -o  pangu-nginx-release-1.0.5-rc1-patch2.tar ampregistry:5000/pangu-nginx:release-1.0.5-rc1-patch2、
tar -cJvf pangu-nginx-release-1.0.5-rc1-patch2.tar.xz pangu-nginx-release-1.0.5-rc1-patch2.tar

./sdc-upload-linux -k eyJpZCI6MjQzfQ.E2e6Dw.tCYxnVpNfzLIhh4bcxbEPISNlII -p EBG发布版本/盘古/test版本/主线版本/V1.0.2/V1.0.2.RC2/业务/  pangu-pangu-1.0.2-rc2.image.tar.xz
```



bash -c "/opt/securitycore/dist/tools/check-dep --need-services pubsub,storage/seaweed && /opt/securitycore/entrypoint.sh demod/bin/demod-goflow --servant-type=DemodServant --service=demod-A --port=8423 --prefix=demod-A-1 --limbo.addr=m8-ebg-pangu-test-biz03.ops.megvii-inc.com:8424 --decoder.interval=4 --limbo.type=A --decoder.maxHeight=720 --decoder.maxWidth=1280 --decoder.memory_size=1368576000 --hedwig.brokers=m8-ebg-pangu-test-biz03.ops.megvii-inc.com:23310 --engine.decode.gpu=0; echo 'Program exits, sleep 120 seconds before restart' && sleep 120"



bash -c "/opt/securitycore/dist/tools/check-dep --need-services pubsub,storage/seaweed && /opt/securitycore/entrypoint.sh demod/bin/demod-goflow --servant-type=DemodServant --service=demod-A --port=8423 --prefix=demod-A-1 --limbo.addr=MEGVII219141189:8424 --decoder.interval=4 --limbo.type=A --decoder.maxHeight=720 --decoder.maxWidth=1280 --decoder.memory_size=1368576000 --hedwig.brokers=M014301712004000033:23310 --engine.decode.gpu=0; echo 'Program exits, sleep 120 seconds before restart' && sleep 120"





ampregistry:5000/screlease:pangu.custom-20211025_5.8-2021.01-release.ebg-298f53d8-build687399.ebg

ampregistry:5000/screlease:pangu.custom-20211025_5.8-2021.01-release.ebg-298f53d8-build687399.ebg





sh install.sh -p /Users/liuxing/Documents/gitcode/megvii/pangu/ -q pangu_V1.1.0.B05 -m /Users/liuxing/Documents/gitcode/megvii/middle/ -n pangu_V1.1.0.B05 -b deploy




## 20210802

1. 事件规则兼容设备表开发；
2. 110openAPI gitbook文档编写；
3. 门禁发卡技术方案评审；
4. 开发环境加密狗处理



## 20210809

1. 106代码合并，编译、启动验证；
2. 排查解决企标人数统计录像回放没有问题；
3. 企标 门禁告警数据生成；



## 20210901

- 修改端口不生效问题排查：nginx 配置文件没有修改
- 冒烟环境内存崩了，服务不能正常重启问题排查处理；
- OpenAPI技术方案评审
- 测试Case评审



## 20210906

- OpenAPI问题修复：推送数据字段是否必须、事件列表返回字段对齐、
- OpenAPI技术方案评审

## 20210907

- 事件类型为插件化开发新增、删除、更改状态接口

  



## 警戒回合

```
sh install.sh -p /Users/liuxing/Documents/gitcode/megvii/pangu/ -q pangu-1.1.0/dev-merge-106-alg -m /Users/liuxing/Documents/gitcode/megvii/middle/ -n pangu-1.1.0/dev-merge-106-alg -b install
```



#### 疑问代码

```
AlarmOtherServiceImpl //未必可行
AbstractDashboardService // 已处理
AlarmAuthDictTypeEnum // 已处理
```

涉及项目：starter、base、alarm、web、OpenAPI

```
AREA_WARN__GOODS_FORGET(326L, 0L, "goodsForget", "物品遗留", 300L, 3L, true),
AREA_WARN__GOODS_DETECT(327L, 0L, "goodsDetect", "携带物品", 300L, 3L, true),
AREA_WARN__SUNDRY_DETECT(328L, 0L, "sundryDetect", "杂物堆放", 300L, 3L, true),
AREA_WARN__GOODS_GUARD(329L, 0L, "goodsGuard", "物品看守", 300L, 3L, true)
```



机器列表：

```
110开发：
10.122.101.11   security / securityM014300931907000351
10.122.101.191  security / security014300029618

110伴随：
10.122.101.86
10.122.101.85
10.122.101.173

```

代码合并命令





冒烟问题

1. 显卡版本升级
2. 证书错误 ， 安监菜单没出来
3. 设备接入错误：etcd 启动失败，重启好了，
4. efs 端口问题处理，添加环境变量：
5. 视频预览展示失败问题排查：仍然使用的是gmp，而当前环境没有部署gmp，添加环境变量GMP_ENABLE为false即可
6. 发现运维改端口遗漏问题  @周佳明 确认是否修改环境变量



需要增加环境变量

```
GMP_ENABLE=false
HTTP_PORT=80
HTTPS_PORT=443
efs.httpPort
efs.httpsPort
```



```
event.setData(JsonUtil.toJson(doc, new String[]{"deviceId","deviceIdType","deviceSetId","zoneId","zoneName", "zoneUuid",gmtCreate", "gmtModified"}));

SpringUtils.getBean(DefaultMessageProducer.class).handle(JSONObject.toJSONString(event));
```





```sql
INSERT INTO `event_type` values (326,"f61f32a5d85b4ff9a5f4469432d25149","物品遗留","goodsForget","3",300,"zone_controll_model,alarm_type_action","pangu,pangu_xinghe,pangu_haihe,pangu_yy",520,0,now(),now());
INSERT INTO `event_type` values (327,"361bce482e9b432c9acbef1eef2d084c","携带物品","goodsDetect","3",300,"zone_controll_model,alarm_type_action","pangu,pangu_xinghe,pangu_haihe,pangu_yy",540,0,now(),now());
INSERT INTO `event_type` values (328,"c204c4e7b3034335917b91197745c613","杂物堆放","sundryDetect","3",300,"zone_controll_model,alarm_type_action","pangu,pangu_xinghe,pangu_haihe,pangu_yy",560,0,now(),now());
INSERT INTO `event_type` values (329,"9f1e2d73801349e496951f55bf794f55","物品看守","goodsGuard","3",300,"zone_controll_model,alarm_type_action","pangu,pangu_xinghe,pangu_haihe,pangu_yy",580,0,now(),now());


```



```java
AN_JIAN(600L, 0L, "anJian", "生产安监", 0L, 6L, true),
NO_SAFETYCAP(601L, 0L, "no_safetycap", "未佩戴安全帽", 600L, 6L, true),
NO_SAFETYBELT(602L, 0L, "no_safetybelt", "未穿戴工服", 600L, 6L, true),
NO_UNIFORM(603L, 0L, "no_uniform", "未佩戴安全带", 600L, 6L, true),
SMOKE(604L, 0L, "smoke", "火焰报警", 600L, 6L, true),
ONFIRE(605L, 0L, "onfire", "烟雾报警", 600L, 6L, true),

AREA_WARN__GOODS_FORGET(326L, 0L, "goodsForget", "物品遗留", 300L, 3L, true),
AREA_WARN__GOODS_DETECT(327L, 0L, "goodsDetect", "携带物品", 300L, 3L, true),
AREA_WARN__SUNDRY_DETECT(328L, 0L, "sundryDetect", "杂物堆放", 300L, 3L, true),
AREA_WARN__GOODS_GUARD(329L, 0L, "goodsGuard", "物品看守", 300L, 3L, true),
```

```
SpringUtils.getBean(DefaultMessageProducer.class).handle(JSONObject.toJSONString(event));
```


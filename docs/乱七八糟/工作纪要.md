## 2020-06-11

1. 修复事件记录导出Bug:  https://jira.megvii-inc.com/browse/EBGPG-559
2. 开发数据推送openAPI，提供第三方订阅、解除订阅、查询订阅接口





## 2020-06-23

1. 导出去掉日志文件
2. 事件记录警戒扩展抓拍图坐标
3. 参与晨会
4. 





## 2020-10-11

1. 合并异常专项代码
2. 插件化接口支持
3. 字段唯一性校验



```
2021-Oct-10 21:27:19.813 ERROR [scheduler_Worker-5] [TID:] org.quartz.core.JobRunShell - Job groupname.dashboard_statistics_modify_task threw an unhandled Exception:
com.megvii.bbu.common.util.bone.MegviiException: 系统异常
        at com.megvii.bbucloud.misc.provider.service.task.impl.TaskService.create(TaskService.java:159) ~[classes!/:1.1.0_test-SNAPSHOT]
        at com.megvii.bbucloud.misc.provider.service.task.impl.TaskService$$FastClassBySpringCGLIB$$2de1a843.invoke(<generated>) ~[classes!/:1.1.0_test-SNAPSHOT]
        at org.springframework.cglib.proxy.MethodProxy.invoke(MethodProxy.java:204) ~[spring-core-5.0.7.RELEASE.jar!/:5.0.7.RELEASE]
        at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:684) ~[spring-aop-5.0.7.RELEASE.jar!/:5.0.7.RELEASE]
        at com.megvii.bbucloud.misc.provider.service.task.impl.TaskService$$EnhancerBySpringCGLIB$$67f4178c.create(<generated>) ~[classes!/:1.1.0_test-SNAPSHOT]
        at sun.reflect.GeneratedMethodAccessor237.invoke(Unknown Source) ~[na:na]
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[na:1.8.0_141]
        at java.lang.reflect.Method.invoke(Method.java:498) ~[na:1.8.0_141]
        at org.springframework.util.ReflectionUtils.invokeMethod(ReflectionUtils.java:223) ~[spring-core-5.0.7.RELEASE.jar!/:5.0.7.RELEASE]
        at org.springframework.cloud.context.scope.GenericScope$LockedScopedProxyFactoryBean.invoke(GenericScope.java:494) ~[spring-cloud-context-2.0.0.RELEASE.jar!/:2.0.0.RELEASE]
        at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:185) ~[spring-aop-5.0.7.RELEASE.jar!/:5.0.7.RELEASE]
        at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:688) ~[spring-aop-5.0.7.RELEASE.jar!/:5.0.7.RELEASE]
        at com.megvii.bbucloud.misc.provider.service.task.impl.TaskService$$EnhancerBySpringCGLIB$$7e4275e0.create(<generated>) ~[classes!/:1.1.0_test-SNAPSHOT]
        at com.megvii.bbucloud.misc.provider.service.task.impl.TaskSchedulerTrigger.execute(TaskSchedulerTrigger.java:57) ~[classes!/:1.1.0_test-SNAPSHOT]
        at org.quartz.core.JobRunShell.run(JobRunShell.java:202) ~[quartz-2.3.0.jar!/:na]
        at org.quartz.simpl.SimpleThreadPool$WorkerThread.run(SimpleThreadPool.java:573) [quartz-2.3.0.jar!/:na]
2021-Oct-10 21:27:19.813 ERROR [scheduler_Worker-8] [TID:] org.quartz.core.JobRunShell - Job groupname.cron_alarm_leave_perimeter_task threw an unhandled Exception:
com.megvii.bbu.common.util.bone.MegviiException: 系统异常
        at com.megvii.bbucloud.misc.provider.service.task.impl.TaskService.create(TaskService.java:159) ~[classes!/:1.1.0_test-SNAPSHOT]
        at com.megvii.bbucloud.misc.provider.service.task.impl.TaskService$$FastClassBySpringCGLIB$$2de1a843.invoke(<generated>) ~[classes!/:1.1.0_test-SNAPSHOT]
        at org.springframework.cglib.proxy.MethodProxy.invoke(MethodProxy.java:204) ~[spring-core-5.0.7.RELEASE.jar!/:5.0.7.RELEASE]
        at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:684) ~[spring-aop-5.0.7.RELEASE.jar!/:5.0.7.RELEASE]
        at com.megvii.bbucloud.misc.provider.service.task.impl.TaskService$$EnhancerBySpringCGLIB$$67f4178c.create(<generated>) ~[classes!/:1.1.0_test-SNAPSHOT]
        at sun.reflect.GeneratedMethodAccessor237.invoke(Unknown Source) ~[na:na]
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[na:1.8.0_141]
        at java.lang.reflect.Method.invoke(Method.java:498) ~[na:1.8.0_141]
        at org.springframework.util.ReflectionUtils.invokeMethod(ReflectionUtils.java:223) ~[spring-core-5.0.7.RELEASE.jar!/:5.0.7.RELEASE]
        at org.springframework.cloud.context.scope.GenericScope$LockedScopedProxyFactoryBean.invoke(GenericScope.java:494) ~[spring-cloud-context-2.0.0.RELEASE.jar!/:2.0.0.RELEASE]
        at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:185) ~[spring-aop-5.0.7.RELEASE.jar!/:5.0.7.RELEASE]
        at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:688) ~[spring-aop-5.0.7.RELEASE.jar!/:5.0.7.RELEASE]
        at com.megvii.bbucloud.misc.provider.service.task.impl.TaskService$$EnhancerBySpringCGLIB$$7e4275e0.create(<generated>) ~[classes!/:1.1.0_test-SNAPSHOT]
        at com.megvii.bbucloud.misc.provider.service.task.impl.TaskSchedulerTrigger.execute(TaskSchedulerTrigger.java:57) ~[classes!/:1.1.0_test-SNAPSHOT]
        at org.quartz.core.JobRunShell.run(JobRunShell.java:202) ~[quartz-2.3.0.jar!/:na]
        at org.quartz.simpl.SimpleThreadPool$WorkerThread.run(SimpleThreadPool.java:573) [quartz-2.3.0.jar!/:na]
2021-Oct-10 21:27:19.844 DEBUG [http-nio-18091-exec-87] [TID:78348344ddcc42e99a03d9c882db08fa] c.m.b.m.p.d.t.m.T.selectOneByExample - ==>  Preparing: select id, task_scheduler_id, syss
, owner_id, deal_type, type, source, cron_expression, define, params, timeout, time_unit, status, gmt_create, gmt_modified from task_scheduler WHERE ( task_scheduler_id = ? ) limit 1
2021-Oct-10 21:27:19.847 DEBUG [http-nio-18091-exec-87] [TID:78348344ddcc42e99a03d9c882db08fa] c.m.b.m.p.d.t.m.T.selectOneByExample - ==> Parameters: scheduler_id_pass_record_clear(Stt
ring)
2021-Oct-10 21:27:19.849 DEBUG [http-nio-18091-exec-87] [TID:78348344ddcc42e99a03d9c882db08fa] c.m.b.m.p.d.t.m.T.selectOneByExample - <==      Total: 1
2021-Oct-10 21:27:19.849 ERROR [scheduler_Worker-4] [TID:] org.quartz.core.JobRunShell - Job groupname.976055aae31445c5a583ebc1a53c7514 threw an unhandled Exception:
com.megvii.bbu.common.util.bone.MegviiException: 系统异常
        at com.megvii.bbucloud.misc.provider.service.task.impl.TaskService.create(TaskService.java:159) ~[classes!/:1.1.0_test-SNAPSHOT]
        at com.megvii.bbucloud.misc.provider.service.task.impl.TaskService$$FastClassBySpringCGLIB$$2de1a843.invoke(<generated>) ~[classes!/:1.1.0_test-SNAPSHOT]
        at org.springframework.cglib.proxy.MethodProxy.invoke(MethodProxy.java:204) ~[spring-core-5.0.7.RELEASE.jar!/:5.0.7.RELEASE]
        at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:684) ~[spring-aop-5.0.7.RELEASE.jar!/:5.0.7.RELEASE]
```



```
        try {
            mqProvider.send(topic, req.getDefine(), "", JSONObject.toJSONString(mqTaskDto));
        } catch (Exception e) {
            log.warn("任务中心发送mq消息时异常:{}", e.getMessage());
            this.delete(taskId);
            throw new MegviiException(MegviiCommonErrorCode.SYSTEM_ERROR);
        }
```





#### pangu-person

```sql
ALTER TABLE person_cluster_task_config MODIFY COLUMN name VARCHAR(40) CHARACTER SET utf8 COLLATE utf8_bin DEFAULT NULL COMMENT '任务名称';
```



#### pangu-pass

```sql
ALTER TABLE display_device MODIFY COLUMN name VARCHAR(255) CHARACTER SET utf8 COLLATE utf8_bin DEFAULT NULL COMMENT '设备名称';
```



#### pangu-attendance

```sql
ALTER TABLE attendance_group MODIFY COLUMN name VARCHAR(200) CHARACTER SET utf8 COLLATE utf8_bin DEFAULT NULL COMMENT '考勤组名称';
```



#### pangu-base

```sql
ALTER TABLE event_rule MODIFY COLUMN name VARCHAR(100) CHARACTER SET utf8 COLLATE utf8_bin DEFAULT NULL COMMENT '事件规则名';
```



#### pangu-alarm

```sql
ALTER TABLE person_number_device_group MODIFY COLUMN name VARCHAR(255) CHARACTER SET utf8 COLLATE utf8_bin DEFAULT NULL COMMENT '设备组名';
```



#### pangu-structure

```sql
ALTER TABLE structure_rule MODIFY COLUMN rule_name VARCHAR(100) CHARACTER SET utf8 COLLATE utf8_bin DEFAULT NULL COMMENT '布控名称或叫规则名称';
```





#### middle_end_pass

```sql
ALTER TABLE schedule MODIFY COLUMN name VARCHAR(50) CHARACTER SET utf8 COLLATE utf8_bin DEFAULT NULL COMMENT '名字';
ALTER TABLE rule MODIFY COLUMN name VARCHAR(50) CHARACTER SET utf8 COLLATE utf8_bin DEFAULT NULL COMMENT '名字';
ALTER TABLE `group` MODIFY COLUMN name VARCHAR(40) CHARACTER SET utf8 COLLATE utf8_bin DEFAULT NULL COMMENT '名字';
```



#### middle_end_base

```sql
ALTER TABLE org MODIFY COLUMN full_name VARCHAR(100) CHARACTER SET utf8 COLLATE utf8_bin DEFAULT NULL COMMENT '组织名' ;
ALTER TABLE zone MODIFY COLUMN name VARCHAR(100) CHARACTER SET utf8 COLLATE utf8_bin DEFAULT NULL COMMENT '组织名' ;

```



#### middle_end_device

```sql
ALTER TABLE base_device MODIFY COLUMN name VARCHAR(100) CHARACTER SET utf8 COLLATE utf8_bin DEFAULT NULL COMMENT '名称';
```



#### bbu_middle_end_auth

```sql
ALTER TABLE user_detail MODIFY COLUMN login_name VARCHAR(255) CHARACTER SET utf8 COLLATE utf8_bin DEFAULT NULL;
```






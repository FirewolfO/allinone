---
title: 市政府项目方案
tags: 新建,模板,小书匠
grammar_cjkRuby: true
---

# 红名单
## 一、添加红名单底库
com.megvii.aipark.group.web.GroupBizController#addGroup
处理的是group_biz表，通过给type扩展一个值6来表示红名单，

## 二、查询红名单底库
com.megvii.aipark.group.web.GroupBizController#getGroupList(com.megvii.aipark.group.domain.req.GroupListReq)
需要查询出红名单底库列表和各个底库中人员的数量，
白名单关联表：group_biz、group_person
黑名单：group_biz、group_person_black
车辆黑名单：group_biz、vehicle_group_relation

## 三、添加人员
com.megvii.aipark.base.web.PersonsController#addPerson

添加人员逻辑：
1. 添加人员信息到person表
2. 添加或者更新头像
3. 如果是黑名单，则更新group_person_black表
4. 如果是员工，则分为两类：
	 a. 新增员工没有底库Id（企业下新增的）：更新group_person表，会把人员和企业下的所有底库进行绑定
	 b. 新增的员工有底库Id（底库下新增的）：更新group_person（人员底库）和group_biz_relation （此时objectId为用户id，group_biz_id为底库ID）
5. 如果是访客表，则更新visit_ext表
6. 更新person_image表，重新处理用户和图片ID关联关系




## 仪创表结构对接

## 人员信息：

|  字段名   | 字段类型     | 是否必须     | 描述     |
| --- | --- | --- | --- |
|  name   | string     | 是     |  人员姓名    |
|  tag   |     int     |    是  |  人员类型，标识出是那种名单的（红、黑、白）    |
|  gender   |  int    |  否   | 人员性别  0-男 1-女     |
| birthday | datetime | 否|  出生日期 | 
| identity_number | string | 否 | 证件号 |

- 人员姓名   
- 人员类型（黑、白、红）
- 性别